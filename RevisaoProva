CREATE DATABASE DB_REIS
USE DB_REIS

CREATE TABLE ALUNO
( COD INT PRIMARY KEY,
NOME VARCHAR(30),
NOTA1 NUMERIC(3,1),
NOTA2 NUMERIC(3,1),
QTDEFALTA INT,
QTDEAULA INT
)
INSERT INTO ALUNO VALUES(1, 'ANA PAULA', 8, 7,1,100)
INSERT INTO ALUNO VALUES(2, 'MARIA', 6, 4,5,100)
INSERT INTO ALUNO VALUES(3, 'MARIO', 6, 8,2,100)
INSERT INTO ALUNO VALUES(4, 'SALETE', 3, 7,10,100)
INSERT INTO ALUNO VALUES(5, 'ANTONIO', 3, 3,30,100) 

DECLARE ALUNO_CURSOR CURSOR FOR
SELECT COD, NOME, NOTA1, NOTA2, QTDEFALTA, QTDEAULA FROM ALUNO

OPEN ALUNO_CURSOR

DECLARE @COD INT
DECLARE @NOME VARCHAR(30)
DECLARE @NOTA1 NUMERIC(3,1)
DECLARE @NOTA2 NUMERIC(3,1)
DECLARE @QTDEFALTA INT
DECLARE @QTDEAULA INT
DECLARE @RESU VARCHAR(20)
FETCH NEXT FROM ALUNO_CURSOR INTO @COD, @NOME, @NOTA1, @NOTA2, @QTDEFALTA, @QTDEAULA

WHILE @@FETCH_STATUS = 0
BEGIN 
IF ((@NOTA1 + @NOTA2)/2) >=6
BEGIN
SET @RESU = 'APROVADO'
END
ELSE IF ((@NOTA1 + @NOTA2)/2) > 4 AND ((@NOTA1 + @NOTA2)/2) < 6
BEGIN
SET @RESU = 'RECUPERAÇÃO'
END
ELSE
BEGIN
SET @RESU = 'RECUPERAÇÃO'
END

PRINT 'ALUNO = ' + @NOME
PRINT 'MEDIA = ' + CAST(((@NOTA1 + @NOTA2)/2)AS VARCHAR)
PRINT 'RESULTADO = ' + @RESU

IF @QTDEFALTA > ((@QTDEAULA*20)/100)
PRINT 'REPROVADO POR FALTA'
PRINT '----------------------------------'
FETCH NEXT FROM ALUNO_CURSOR INTO @COD, @NOME, @NOTA1, @NOTA2, @QTDEFALTA, @QTDEAULA
END

CLOSE ALUNO_CURSOR
